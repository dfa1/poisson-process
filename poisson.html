<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js"></script>
        <!--[if IE]><script language="javascript" type="text/javascript" src="http://people.iola.dk/olau/flot/excanvas.min.js"></script><![endif]-->
        <script language="javascript" type="text/javascript" src="http://people.iola.dk/olau/flot/jquery.flot.js"></script>
        <script type="text/javascript" src="functional.js"></script>
        <script type="text/javascript">
            $(function() {
                function poisson(lambda) {
                    return -Math.log(Math.random()) / lambda;
                }
                
                function n(array) {
                    return array.length;
                }

                function sum(array) {
                    return reduce(array, operators.add, 0);
                }

                function mean(array) {
                    return sum(array) / n(array);
                }

                $('#calc').click(function() {
                    var lambda = $('#lambda').val();
                    var t = $('#t').val();
                    var n = $('#n').val();
                    var error = false;
                    var aNumber = /^\d+(\.\d+)?$/;

                    if (!lambda || !lambda.match(aNumber) || lambda < 0) {
                        $('#lambda').css('background', 'red');
                        error = true;
                    } else {
                        $('#lambda').css('background', 'white');
                    }

                    if (!n || !n.match(aNumber) || n < 0) {
                        $('#n').css('background', 'red');
                        error = true;
                    } else {
                        $('#n').css('background', 'white');
                    }

                    if (!t || !t.match(aNumber) || t < 0) {
                        $('#t').css('background', 'red');
                        error = true;
                    } else {
                        $('#t').css('background', 'white');
                    }

                    if (error) {
                        return;
                    }

                    $('#results').html('');
                    var trials = [];
                    var graphs = [];

                    for (var i = 0; i < n; i++) {
                        var s = 0;
                        var l = 0;
                        var graph = [];

                        do {
                            var p = poisson(lambda);

                            if (s + p > t) {
                                break;
                            } 
                            
                            s += p;
                            graph.push([s - p, l], [s, l], null);
                            //$(p + '<br/>').appendTo('#results');
                            
                            l += 1;

                            
                        } while (1);

                        graphs.push(graph);
                        trials.push(l);
                    }

                    $('<h2>&lambda;t = ' + (lambda * t) + '</h2>').appendTo('#results');
                    $('<h2>mean = ' + mean(trials) + '</h2>').appendTo('#results');
                    $.plot($("#graph"), graphs);
                });
            });
        </script>
        <style type="text/css">
            * {
                font-family: georgia;
                text-align: justify;
            }

            body {
                margin-top: 3%;
                margin-left: 4%;
                margin-right: 4%;
                padding: 0;
                border: 0;			/* This removes the border around the viewport in old versions of IE */
            }

            input {
                font: inherit;
                margin: 15px;
                padding: 3px;
                display: block;
                width: 60ex;
            }
        </style>
    </head>
    <body>
        <h1>Poisson process simulator</h1>
        <p>
            with &lambda; &gt; 0, t &gt; 0, n &gt; 0
        </p>
        <label>&nbsp;&lambda;&nbsp;</label><input id="lambda" type="text"/>
        <label>&nbsp;t&nbsp;</label><input id="t" type="text"/>
        <label>&nbsp;n&nbsp;</label><input id="n" type="text"/>
        <button id="calc">Simulate!</button>
        <div id="results">
        </div>
        <div id="graph" style="width:600px;height:300px;">
        </div>

        <p>by Davide Angelocola 7/11/2009</p>
    </body>
</html>